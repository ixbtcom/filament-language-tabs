# Builder Locale Tabs – Incremental Strategy

## Этап 1 — Вернуть базовую реактивность табов
1. **Цель:** восстановить работу языковых бейджей и обновление статуса таба при изменении данных в Builder.
2. **Шаги:**
   - В `prepareBuilderForLocale()` и `prepareRepeaterForLocale()` цепочкой вызвать оригинальные `afterStateHydrated`/`afterStateUpdated`, чтобы сохранить нормализацию состояния, реализованную Filament.
   - В коллбеке `afterStateUpdated` вызвать `refreshFormData(["{$attribute}.{$locale}", $attribute])`, чтобы подсветка локали получала новое состояние сразу.
3. **Проверка:** ручной прогон — редактировать блок в `content.en` и убедиться, что таб `en` переключает бейдж на «заполнено». Повторить для другой локали.

## Этап 2 — Минимальные регрессионные тесты
1. **Цель:** зафиксировать поведение, чтобы не вернуться к багу.
2. **Шаги:**
   - Добавить Livewire/Pest тест, создающий форму с `LanguageTabs + Builder`. В тесте обновить поле и убедиться, что в state Livewire изменился `content['en']`.
   - Аналогичный тест для Repeater (если используется).
3. **Проверка:** `composer test:pest`.

## Этап 3 — Нормализация пустых состояний
1. **Цель:** обработать сценарии, когда локаль ещё не имеет данных.
2. **Шаги:**
   - В `afterStateHydrated` подавать `[]` вместо `null`/`''` для контейнеров, чтобы Builder/Repeater могли добавлять элементы без ошибок.
3. **Проверка:** создать новую запись, сразу добавить блок в «пустой» локали, убедиться, что таб обновляется.

## Этап 4 — Подготовка к вложенным структурам
1. **Цель:** обеспечить поддержку Builder/Repeater внутри блоков.
2. **Шаги:**
   - Внедрить рекурсивную обработку дочерних компонентов (на базе `prepareContainerChildrenForLocale` из `fix-builder.md`), начиная с простого сценария: Repeater внутри блока Builder.
   - При необходимости использовать глубокое клонирование (`deepCloneComponent`).
3. **Проверка:** добавить тест с вложенным контейнером и убедиться, что статус локали обновляется на обоих уровнях.

## Этап 5 — Документация и гайды
1. **Цель:** зафиксировать ограничения и правильный сценарий использования.
2. **Шаги:**
   - Обновить CONTRIBUTING/README с краткими рекомендациями по использованию LanguageTabs с контейнерными полями.
3. **Проверка:** ревью документа, согласование с командой.
